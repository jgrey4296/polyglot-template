#!/usr/bin/env bash
# polyglot -*- mode: sh -*-
# Main sh script for polyglot projects, to hook into cargo.

VERSION="0.1.0"

current_script_path="${BASH_SOURCE[0]}"
_SRC=$(realpath "$(dirname "$current_script_path")")

source "$_SRC/lib-util.bash"

# General
VERBOSE=0

function _print_help () {
    header "{{cookiecutter.proj_name}} ${POLYGLOT_VERSION} - "
    echo -e "
cargo {{cookiecutter.proj_name}} [-v|--verbose] [subcmd] [args*] [-h | --help]

SubCommands:

"
    _stub_env_vars
}

function _stub_env_vars () {
    echo "# -- {{cookiecutter.proj_name}} Environment Variables for .envrc"
    echo "export EXAMPLE=\"\$PWD\""
    echo "# --"

}

function _parse_args () {
    if [[ "$1" = "{{cookiecutter.proj_name}}" ]]; then
        shift
    fi
    if [[ $# -eq 0  ]]; then
        _print_help
        exit
    fi

    case $1 in
        -h|--help)
            _print_help
            exit
            ;;
        --version)
            echo "$VERSION"
            ;;
        -v|--verbose)
            VERBOSE=1
            ;;
        -t|--target)
            echo "Target: $2"
            ;;
        --*=*)
            echo "Assignment: $1"
            ;;
        vars)
            _stub_env_vars
            ;;
        *) # Positional
            echo "Positional: $1"
            ;;
    esac
}

_parse_args "$@"
