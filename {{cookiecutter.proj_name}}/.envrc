#  .envrc -*- mode: sh -*-
# See https://direnv.net/
# export VAR=VAL
# PATH_add val

# venv location
if [[ -z "$READTHEDOCS" ]]; then
    export UV_PROJECT_ENVIRONMENT="$PWD/.temp/venv"
else
    # readthedocs uses its own location
    export UV_PROJECT_ENVIRONMENT="$READTHEDOCS_VIRTUALENV_PATH"
fi
if [[ -d "$UV_PROJECT_ENVIRONMENT" ]]; then
    source "$UV_PROJECT_ENVIRONMENT/bin/activate"
fi
export PYTHONPATH="$PWD/.tasks:$PYTHONPATH"

# user local
PATH_add "$HOME/.local/bin"

# asdf
PATH_add "$ASDF_DATA_DIR/shims"
asdf reshim

# For JVM setup
source "$SDKMAN_DIR/bin/sdkman-init.sh"
sdk env > /dev/null

# For Android:
PATH_add "$ANDROID_HOME/cmdline-tools/latest/bin"
PATH_add "$ANDROID_HOME/platform-tools"

# For dotnet
DOTNET_ROOT="$(asdf where dotnet)"
export DOTNET_ROOT
PATH_add "$DOTNET_CLI_HOME/.dotnet/tools"

# latex
PATH_add "$TEXBASE/bin/x86_64-linux"
export TEX_LUA_FILE="$PWD/init.tex.lua"

# for ruby
# PATH_add "$(gem environment user_gemhome)/bin"
# PATH_add "$(gem environment gemdir)/bin"

# For Ocaml/Rocq:
switchname=$(basename "$PWD")
opam switch "$switchname" 2>/dev/null
eval "$(opam env)"

# For repo-local tasks
PATH_add "$PWD/.tasks"

# -- Core Polyglot Environment Variables for .envrc
export POLYGLOT_ROOT="$PWD"
export POLYGLOT_SRC="$PWD/src"
export POLYGLOT_LOGS="$PWD/logs"
export POLYGLOT_TEMP="$PWD/.temp"
export POLYGLOT_DOCS="$PWD/.temp/docs"
export POLYGLOT_DATA="$PWD/src/_data"

export POLYGLOT_DEFAULT_LANGS="python;rust"
export POLYGLOT_DEFAULT_TOOLS="mdbook"
export POLYGLOT_DEFAULT_TASKS="validate;sync;build;clean;docs;export;release"
# --

# Pre-commit skipping:
# export SKIP=""

export LIBRARIAN_HANDLERS="lsp:py-lsp:mypy:flycheck:rs-lsp:rs-flycheck"
